{% extends "base.html" %}

{% block content %}
<h2>{{ 'Edit' if policy_id else 'Create' }} {{ policy_type|title }} Policy</h2>
<form action="/org/{{ org_id }}/policies/save" method="post">
    {% if policy_id %}
    <input type="hidden" name="policy_id" value="{{ policy_id }}">
    {% endif %}
    <input type="hidden" name="policy_type" value="{{ policy_type }}">

    <div class="mb-3">
        <label class="form-label">Policy Name ID (e.g. {{ org_id }}_{{ policy_type }}_1)</label>
        <input type="text" class="form-control" name="new_policy_id" value="{{ policy_id or '' }}" {{ 'readonly' if
            policy_id else 'required' }}>
    </div>

    {% if policy_type == 'password' %}
    <!-- Password Policy Section -->
    <div class="card mb-3">
        <div class="card-header">Password Rules</div>
        <div class="card-body">
            <div class="mb-3">
                <label class="form-label">Minimum Length</label>
                <input type="number" class="form-control" name="password_min_length"
                    value="{{ policy.get('password_min_length', 8) }}">
            </div>
            <div class="form-check form-switch mb-3">
                <input class="form-check-input" type="checkbox" name="password_require_number" id="reqNum" {{ 'checked'
                    if policy.get('password_require_number') else '' }}>
                <label class="form-check-label" for="reqNum">Require Numbers</label>
            </div>
            <div class="form-check form-switch mb-3">
                <input class="form-check-input" type="checkbox" name="password_require_special_char" id="reqSpec"
                    {{ 'checked' if policy.get('password_require_special_char') else '' }}>
                <label class="form-check-label" for="reqSpec">Require Special Characters</label>
            </div>
            <div class="form-check form-switch mb-3">
                <input class="form-check-input" type="checkbox" name="password_reject_common" id="rejCommon"
                    {{ 'checked' if policy.get('password_reject_common') else '' }}>
                <label class="form-check-label text-danger" for="rejCommon">Reject Common Passwords</label>
            </div>
        </div>
    </div>
    {% elif policy_type == 'mfa' %}
    <!-- MFA Policy Section -->
    <div class="card mb-3">
        <div class="card-header">MFA Settings</div>
        <div class="card-body">
            <div class="mb-3">
                <label class="form-label">MFA Required</label>
                <select class="form-select" name="mfa_required">
                    <option value="false" {{ 'selected' if not policy.get('mfa_required') else '' }}>No</option>
                    <option value="true" {{ 'selected' if policy.get('mfa_required') else '' }}>Yes</option>
                </select>
            </div>
        </div>
    </div>
    {% elif policy_type == 'ip_whitelist' %}
    <!-- IP Policy Section -->
    <div class="card mb-3">
        <div class="card-header">IP Whitelist</div>
        <div class="card-body">
            <div class="mb-3">
                <label class="form-label">Allowed CIDRs (comma separated)</label>
                <input type="text" class="form-control" name="allowed_cidrs"
                    value="{{ (policy.get('allowed_cidrs', []) or []) | join(',') }}">
            </div>
        </div>
    </div>
    {% elif policy_type == 'session' %}
    <!-- Session Policy Section -->
    <div class="card mb-3">
        <div class="card-header">Session Constraints</div>
        <div class="card-body">
            <div class="mb-3">
                <label class="form-label">Timeout (Minutes)</label>
                <input type="number" class="form-control" name="session_timeout_minutes"
                    value="{{ policy.get('session_timeout_minutes', 1440) }}">
            </div>
        </div>
    </div>
    {% endif %}

    <button type="submit" class="btn btn-primary">Save Policy</button>
    <a href="/org/{{ org_id }}" class="btn btn-secondary">Cancel</a>
</form>
{% endblock %}